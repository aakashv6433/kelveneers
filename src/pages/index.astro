---
import "../styles/global.css";
import Hero from "../components/home/Hero.astro";
import Header from "../components/common/Header.astro";
import ProductCategories from "../components/home/ProductCategories.astro";
import OurCatalogue from "../components/home/OurCatalogue.astro";
import TimberSustainabilityCycle from "../components/home/TimberSustainabilityCycle.astro";
import ClientCarousel from "../components/home/ClientCarousel.astro";
import FollowSection from "../components/home/FollowSection.astro";
import Footer from "../components/common/Footer.astro";

const clientImageModules = import.meta.glob(
  "../assets/clientele/compressed_for_the_clientele_page/*.png",
  {
    eager: true,
  }
);
const clientImages = Object.entries(clientImageModules)
  .map(([path, module]: [string, any]) => {
    const name = path.split("/").pop()?.replace(".png", "") || "";
    return {
      src: module.default.src,
      name,
    };
  })
  .sort((a, b) => parseInt(a.name) - parseInt(b.name));
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <link
      rel="icon"
      type="image/svg+xml"
      href={`${import.meta.env.BASE_URL}favicon.svg`}
    />
    <meta name="generator" content={Astro.generator} />
    <title>kelveneers</title>
    {
      clientImages.map((image) => (
        <link rel="preload" href={image.src} as="image" />
      ))
    }
    <script>
      // Scroll to top on page load/refresh
      if ("scrollRestoration" in history) {
        history.scrollRestoration = "manual";
      }
      window.scrollTo(0, 0);
    </script>
    <style>
      /* Site loader styles (same as PageLayout) */
      .site-loader {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #351c24; /* primary theme color */
        z-index: 2000;
        transition:
          opacity 300ms ease,
          visibility 300ms ease;
        opacity: 1;
        visibility: visible;
      }

      .site-loader.hide {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .site-loader__inner {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }

      .site-loader__ring {
        display: inline-grid;
        place-items: center;
        width: 96px;
        height: 96px;
        border-radius: 9999px;
        padding: 8px; /* space between logo and ring */
        box-sizing: border-box;
        background: transparent;
        position: relative;
      }

      .site-loader__ring-svg {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        animation: kv-spin 815ms linear infinite;
      }

      .site-loader__logo {
        width: 72px;
        height: auto;
        z-index: 2;
      }

      @keyframes kv-spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body class="home-page">
    <!-- Site loader shown on initial page load for ~700ms -->
    <div id="site-loader" class="site-loader">
      <div class="site-loader__inner" role="status" aria-label="Loading">
        <div class="site-loader__ring" aria-hidden="true">
          <svg class="site-loader__ring-svg" viewBox="0 0 100 100">
            <circle
              cx="50"
              cy="50"
              r="45"
              fill="none"
              stroke="#d85f3e"
              stroke-width="5"
              stroke-linecap="round"
              stroke-dasharray="50 230"></circle>
          </svg>
          <svg
            class="site-loader__logo"
            viewBox="110 110 860 870"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            aria-label="Kelveneers"
          >
            <defs>
              <style>
                .cls-1 {
                  fill: none;
                }
                .cls-2 {
                  fill: #e96a4d;
                }
                .cls-3 {
                  fill: #d85f3e;
                }
                .cls-4 {
                  clip-path: url(#clippath);
                }
              </style>
              <clipPath id="clippath">
                <rect
                  class="cls-1"
                  x="593.79"
                  y="736.08"
                  width="83.22"
                  height="83.22"></rect>
              </clipPath>
            </defs>
            <g class="cls-4">
              <path
                class="cls-2"
                d="M629.78,766.61h5.51c1.84,0,3.21.44,4.1,1.34.89.9,1.33,2.14,1.33,3.71,0,.74-.11,1.42-.34,2.02-.23.6-.57,1.12-1.02,1.55-.45.44-1.01.77-1.69,1.01-.68.24-1.47.36-2.37.36h-5.53v-9.99ZM622.91,761.05v33.29h6.86v-12.19h5.47l6.24,12.19h7.36v-.32l-7.2-13.61c.91-.41,1.74-.9,2.47-1.46.73-.56,1.36-1.23,1.88-1.98s.91-1.62,1.19-2.58c.27-.97.41-2.06.41-3.28,0-1.65-.28-3.1-.85-4.35-.56-1.25-1.37-2.29-2.42-3.14-1.05-.85-2.34-1.49-3.87-1.93-1.53-.44-3.25-.65-5.17-.65h-12.37ZM635.4,744.4c18.43,0,33.29,14.86,33.29,33.29s-14.86,33.29-33.29,33.29-33.29-14.86-33.29-33.29,14.86-33.29,33.29-33.29ZM635.4,736.08c-22.93,0-41.61,18.68-41.61,41.61s18.68,41.61,41.61,41.61,41.61-18.68,41.61-41.61-18.68-41.61-41.61-41.61Z"
              ></path>
            </g>
            <g>
              <path
                class="cls-3"
                d="M540,953.96c-228.26,0-413.97-185.7-413.97-413.96S311.74,126.04,540,126.04s413.97,185.7,413.97,413.97-185.7,413.96-413.97,413.96M540,167.33c-205.5,0-372.67,167.17-372.67,372.67s167.17,372.65,372.67,372.65,372.67-167.17,372.67-372.65-167.17-372.67-372.67-372.67"
              ></path>
              <polygon
                class="cls-2"
                points="542.09 472.58 674.43 304.77 626.88 267.73 494.53 435.55 542.09 472.58"
              ></polygon>
              <polygon
                class="cls-2"
                points="610.25 502.52 664.81 511.83 691.54 362.34 636.98 353.03 610.25 502.52"
              ></polygon>
              <polygon
                class="cls-2"
                points="502.21 478.11 412.19 341.44 368.12 375.63 458.12 512.28 502.21 478.11"
              ></polygon>
              <polygon
                class="cls-2"
                points="559.06 312.46 443.21 275.21 428.24 328.8 544.11 366.04 559.06 312.46"
              ></polygon>
              <polygon
                class="cls-2"
                points="296.7 505.93 483.21 625.68 516.02 577.23 329.5 457.47 296.7 505.93"
              ></polygon>
              <polygon
                class="cls-2"
                points="783.3 491.85 748.49 445.17 576.12 584.03 576.12 486.72 517.33 486.72 517.33 812.25 576.12 812.25 576.12 658.79 783.3 491.85"
              ></polygon>
            </g>
          </svg>
        </div>
      </div>
    </div>
    <Header className="home-header" />
    <Hero />
    <ProductCategories />
    <OurCatalogue />
    <TimberSustainabilityCycle />
    <ClientCarousel />
    <FollowSection />
    <Footer />
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      try {
        const siteLoader = document.getElementById("site-loader");
        if (siteLoader) {
          setTimeout(() => {
            siteLoader.classList.add("hide");
            setTimeout(() => siteLoader.remove(), 400);
          }, 700);
        }
      } catch (e) {
        console.error("Loader error:", e);
      }
    });
  </script>
</html>
