---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Interior Doors - using import.meta.glob for proper Vite handling
const interiorDoorsModules = import.meta.glob<{ default: ImageMetadata }>(
  "../../assets/doors/interior-doors/*.png",
  { eager: true }
);
// Helper: extract leading number from the image src filename (e.g. "1-min.png" -> 1)
const extractLeadingNumber = (src: string) => {
  const filename = src.split("/").pop()?.split("?")[0] || "";
  const m = filename.match(/^(\d+)/);
  return m ? parseInt(m[1], 10) : 0;
};

const interiorDoors = Object.values(interiorDoorsModules).sort((a, b) => {
  const aNum = extractLeadingNumber(a.default.src);
  const bNum = extractLeadingNumber(b.default.src);
  return aNum - bNum;
});

const interiorDoorLabels = [
  "STANDARD DOORS",
  "SOLIDWOOD FRAMES",
  "PRIMA DOORS",
  "FRENCH DOOR",
  "CONCEALED DOOR",
  "CHECKER DOOR",
  "HERRINGBONE TEAK",
  "TORN CHERRY",
  "DIAGONAL WALNUT",
  "SURYA MOABI",
  "URBAN OAK",
  "V1-H5",
  "DIAGONAL (GLASS SPLIT)",
  "GROOVED SERIES",
];

// Elite Collection
const eliteDoorsModules = import.meta.glob<{ default: ImageMetadata }>(
  "../../assets/doors/interior-doors/elite/*.png",
  { eager: true }
);
const eliteDoors = Object.values(eliteDoorsModules).sort((a, b) => {
  const aNum = extractLeadingNumber(a.default.src);
  const bNum = extractLeadingNumber(b.default.src);
  return aNum - bNum;
});

// Legacy Collection
const legacyDoorsModules = import.meta.glob<{ default: ImageMetadata }>(
  "../../assets/doors/interior-doors/legacy/*.png",
  { eager: true }
);
const legacyDoors = Object.values(legacyDoorsModules).sort((a, b) => {
  const aNum = extractLeadingNumber(a.default.src);
  const bNum = extractLeadingNumber(b.default.src);
  return aNum - bNum;
});

// Wal Ven Collection
const walVenDoorsModules = import.meta.glob<{ default: ImageMetadata }>(
  "../../assets/doors/interior-doors/wal_ven/*.png",
  { eager: true }
);
const walVenDoors = Object.values(walVenDoorsModules).sort((a, b) => {
  const aNum = extractLeadingNumber(a.default.src);
  const bNum = extractLeadingNumber(b.default.src);
  return aNum - bNum;
});
---

<style>
  /* Make the two-item centered wrapper match the exact width of two outer grid columns
     taking gaps into account. Uses Tailwind default gap sizes: gap-4 = 1rem, gap-8 = 2rem. */
  .two-center {
    box-sizing: border-box;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
  }

  /* sm: grid has 3 columns, gap at sm is gap-4 (1rem) -> total gaps = (3 - 1) * 1rem = 2rem
     width = (100% - totalGaps) * (2/3) + innerGap(1rem) */
  @media (min-width: 640px) {
    .two-center {
      width: calc((100% - 2rem) * (2 / 3) + 1rem);
    }
  }

  /* md: adjust for md gap (gap-6 = 1.5rem) */
  @media (min-width: 640px) {
    .two-center {
      width: calc((100% - 3rem) * (2 / 3) + 1.5rem);
    }
  }

  /* lg: grid has 4 columns, gap at lg is gap-8 (2rem) -> total gaps = (4 - 1) * 2rem = 6rem
     width = (100% - totalGaps) * (2/4) + innerGap(2rem) */
  @media (min-width: 1024px) {
    .two-center {
      width: calc((100% - 6rem) * 0.5 + 2rem);
    }
  }
</style>

<div class="pb-16 sm:pb-20 md:pb-28 lg:pb-32">
  <!-- Interior Doors Section -->
  <h3
    class="pt-0 px-4 sm:px-6 md:px-10 lg:px-0 font-[Altone] text-[#391B26] text-base min-[440px]:text-lg sm:text-xl md:text-2xl lg:text-2xl pb-4 sm:pb-6 md:pb-8 lg:pb-10"
  >
    INTERIOR DOORS
  </h3>
  <div
    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 justify-items-center w-full gap-2 sm:gap-4 md:gap-6 lg:gap-8 gap-y-6 sm:gap-y-8 md:gap-y-10 lg:gap-y-12 px-4 sm:px-6 md:px-10 lg:px-0 pb-16 sm:pb-20 md:pb-24 lg:pb-24 border-b border-[#D6D0C7]"
  >
    {
      interiorDoors.map((door, index) => {
        // When we reach the second-last item, render a full-width grid cell
        // that contains both last items and centers them using flex. Skip
        // rendering the very last item separately.
        if (index === interiorDoors.length - 2) {
          return (
            // span the full row at the "sm" breakpoint (where grid becomes 3 cols)
            <div class="col-span-2 sm:col-span-3 lg:col-span-4 w-full">
              <div class="two-center grid grid-cols-2 gap-2 sm:gap-4 md:gap-6 lg:gap-8">
                {[0, 1].map((i) => {
                  const idx = index + i;
                  return (
                    <div class="w-full">
                      <div
                        class="border border-[#D6D0C7] p-4 sm:p-6 md:p-8 lg:p-12"
                        style="aspect-ratio: 417 / 564;"
                      >
                        <Image
                          src={interiorDoors[idx].default}
                          alt={`Interior Door ${idx + 1}`}
                          class="w-full h-full object-contain"
                        />
                      </div>
                      <p class="text-center font-[Altone] text-[#391B26] py-3 sm:py-4 md:py-4 lg:py-5 text-xs sm:text-sm md:text-base lg:text-base">
                        {interiorDoorLabels[idx]}
                      </p>
                    </div>
                  );
                })}
              </div>
            </div>
          );
        }

        // Skip the very last item because it's rendered together with the
        if (index === interiorDoors.length - 1) {
          return null;
        }

        return (
          <div class="w-full">
            <div
              class="border border-[#D6D0C7] p-4 sm:p-6 md:p-8 lg:p-12"
              style="aspect-ratio: 417 / 564;"
            >
              <Image
                src={door.default}
                alt={`Interior Door ${index + 1}`}
                class="w-full h-full object-contain"
              />
            </div>
            <p class="text-center font-[Altone] text-[#391B26] py-3 sm:py-4 md:py-4 lg:py-5 text-xs sm:text-sm md:text-base lg:text-base">
              {interiorDoorLabels[index]}
            </p>
          </div>
        );
      })
    }
  </div>

  <!-- Elite Collection -->
  <h3
    class="pt-[15vw] sm:pt-[8vw] px-4 sm:px-6 md:px-10 lg:px-16 font-[AcidGrotesk] text-[#391B26] text-2xl sm:text-3xl md:text-4xl lg:text-5xl pb-12 sm:pb-16 md:pb-20 lg:pb-20 text-center"
  >
    <span class="font-light">Elite Collection</span>
  </h3>
  <div
    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 justify-items-center w-full gap-2 sm:gap-4 md:gap-6 lg:gap-8 gap-y-6 sm:gap-y-8 md:gap-y-10 lg:gap-y-12 px-4 sm:px-6 md:px-10 lg:px-0 pb-0"
  >
    {
      eliteDoors.map((door, index) => (
        <div
          class={`w-full ${index === 3 ? "sm:col-start-2 lg:col-start-auto" : ""}`}
        >
          <div
            class="border border-[#D6D0C7] p-4 sm:p-6 md:p-8 lg:p-12"
            style="aspect-ratio: 417 / 564;"
          >
            <Image
              src={door.default}
              alt={`Elite Door ${index + 1}`}
              class="w-full h-full object-contain"
            />
          </div>
        </div>
      ))
    }
  </div>

  <!-- Legacy Collection -->
  <h3
    class="pt-[20vw] sm:pt-[11vw] px-4 sm:px-6 md:px-10 lg:px-16 font-[AcidGrotesk] text-[#391B26] text-2xl sm:text-3xl md:text-4xl lg:text-5xl pb-12 sm:pb-16 md:pb-20 lg:pb-20 text-center"
  >
    <span class="font-light">Legacy Collection</span>
  </h3>
  <div
    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 justify-items-center w-full gap-2 sm:gap-4 md:gap-6 lg:gap-8 gap-y-6 sm:gap-y-8 md:gap-y-10 lg:gap-y-12 px-4 sm:px-6 md:px-10 lg:px-0 pb-0"
  >
    {
      // Legacy has exactly 2 items â€” render them together in a full-width
      // grid cell and center for screens >= sm.
    }
    <div class="col-span-2 sm:col-span-3 lg:col-span-4 w-full">
      <!-- Center legacy two items similarly: sm => 2/3 width, lg => 1/2 width -->
      <div class="two-center grid grid-cols-2 gap-2 sm:gap-4 md:gap-6 lg:gap-8">
        {
          legacyDoors.map((door, index) => (
            <div class="w-full">
              <div
                class="border border-[#D6D0C7] p-4 sm:p-6 md:p-8 lg:p-12"
                style="aspect-ratio: 417 / 564;"
              >
                <Image
                  src={door.default}
                  alt={`Legacy Door ${index + 1}`}
                  class="w-full h-full object-contain"
                />
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>

  <!-- Wal Ven Door Collection -->
  <h3
    class="pt-[20vw] sm:pt-[11vw] px-4 sm:px-6 md:px-10 lg:px-16 font-[AcidGrotesk] text-[#391B26] text-2xl sm:text-3xl md:text-4xl lg:text-5xl pb-12 sm:pb-16 md:pb-20 lg:pb-20 text-center"
  >
    <span class="font-light">Wal Ven Door Collection</span>
  </h3>
  <div
    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 justify-items-center w-full gap-2 sm:gap-4 md:gap-6 lg:gap-8 gap-y-6 sm:gap-y-8 md:gap-y-10 lg:gap-y-12 px-4 sm:px-6 md:px-10 lg:px-0 pb-16 sm:pb-20 md:pb-24 lg:pb-24"
  >
    {
      walVenDoors.map((door, index) => (
        <div
          class={`w-full ${index === 3 ? "sm:col-start-2 lg:col-start-auto" : ""}`}
        >
          <div
            class="border border-[#D6D0C7] p-4 sm:p-6 md:p-8 lg:p-12"
            style="aspect-ratio: 417 / 564;"
          >
            <Image
              src={door.default}
              alt={`Wal Ven Door ${index + 1}`}
              class="w-full h-full object-contain"
            />
          </div>
        </div>
      ))
    }
  </div>
</div>
