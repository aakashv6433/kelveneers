---
/**
 * OurCatalogue Component - Refactored with Mobile Utilities
 *
 * This is an example showing how to use the mobile interaction utilities
 * for cleaner, more maintainable code. You can replace the current
 * OurCatalogue.astro with this version if desired.
 */
import { Image } from "astro:assets";
import ourCatalogueImage from "../../assets/ourcatalogue-homepage.png";
import windowSystemsImage from "../../assets/product-categories-section/window-systems1.png";
import woodenDoorsImage from "../../assets/hero-carousel/4.png";
import framesImage from "../../assets/hero-carousel/2_1.png";
import architecturalImage from "../../assets/hero-carousel/3.png";
import iconImage1 from "../../assets/OurCatalogIcon1.png";
import iconImage2 from "../../assets/OurCatalogIcon2.png";
import iconImage3 from "../../assets/OurCatalogIcon3.png";

const imageUrls = [
  windowSystemsImage,
  woodenDoorsImage,
  framesImage,
  architecturalImage,
];
---

<section>
  <div class="flex pl-4 md:pl-8 py-0 md:py-16">
    <div class="basis-2/3 relative">
      <Image
        src={ourCatalogueImage}
        alt="House"
        loading={"lazy"}
        class="w-full h-auto"
      />

      <div class="absolute inset-0">
        <div
          class="catalogue-icon absolute w-10 h-10 sm:w-12 sm:h-12 cursor-pointer transition-transform duration-200 md:hover:scale-110 active:scale-95"
          style="top: 19%; left: 38%;"
          data-category="0"
          data-title="Window Systems"
        >
          <Image
            src={iconImage1}
            alt="Window Systems Icon"
            class="w-full h-full pointer-events-none"
            loading="lazy"
          />
          <div
            class="absolute inset-0 rounded-full bg-white/20 animate-ping md:hidden icon-pulse"
          >
          </div>
        </div>

        <div
          class="catalogue-icon absolute w-10 h-10 sm:w-12 sm:h-12 cursor-pointer transition-transform duration-200 md:hover:scale-110 active:scale-95"
          style="top: 65%; left: 26%;"
          data-category="1"
          data-title="Wooden Doors"
        >
          <Image
            src={iconImage2}
            alt="Wooden Doors Icon"
            class="w-full h-full pointer-events-none"
            loading="lazy"
          />
          <div
            class="absolute inset-0 rounded-full bg-white/20 animate-ping md:hidden icon-pulse"
          >
          </div>
        </div>

        <div
          class="catalogue-icon absolute w-10 h-10 sm:w-12 sm:h-12 cursor-pointer transition-transform duration-200 md:hover:scale-110 active:scale-95"
          style="top: 60%; right: 24%;"
          data-category="2"
          data-title="Frames"
        >
          <Image
            src={iconImage3}
            alt="Frames Icon"
            class="w-full h-full pointer-events-none"
            loading="lazy"
          />
          <div
            class="absolute inset-0 rounded-full bg-white/20 animate-ping md:hidden icon-pulse"
          >
          </div>
        </div>
      </div>
    </div>

    <div
      class="basis-1/3 border border-[#E5E2D6] p-2 md:p-6 flex flex-col justify-between"
    >
      <div class="flex-1 flex items-center justify-center">
        <Image
          src={windowSystemsImage}
          alt="Product Category"
          class="w-full h-auto max-w-[300px] lg:max-w-[350px] xl:max-w-[450px] opacity-0 transition-opacity duration-300"
          id="catalogue-image"
          loading="lazy"
        />
      </div>
      <h2
        class="font-[AcidGrotesk] font-light text-[#391B26] text-xs-custom text-lg sm:text-xl md:text-2xl lg:text-4xl xl:text-5xl"
      >
        Our Catalogue
      </h2>
    </div>
  </div>
</section>

<script define:vars={{ imageUrls }}>
  import {
    isMobileDevice,
    addDesktopHover,
    addMobileInteraction,
    addTapOutsideDismiss,
    toggleActiveState,
  } from "../../utils/mobileInteractions";

  const icons = document.querySelectorAll(".catalogue-icon");
  const img = document.getElementById("catalogue-image");
  const pulseElements = document.querySelectorAll(".icon-pulse");
  let activeCategoryIndex = -1;

  function updateImage(categoryIndex) {
    if (img && imageUrls[categoryIndex]) {
      img.src = imageUrls[categoryIndex].src;
      img.style.opacity = "1";
      activeCategoryIndex = categoryIndex;

      // Update visual state on mobile
      if (isMobileDevice()) {
        icons.forEach((icon, idx) => {
          toggleActiveState(icon, idx === categoryIndex);
        });
      }
    }
  }

  function hideImage() {
    if (img) {
      img.style.opacity = "0";
      activeCategoryIndex = -1;

      if (isMobileDevice()) {
        icons.forEach((icon) => {
          toggleActiveState(icon, false);
        });
      }
    }
  }

  function stopPulseAnimations() {
    pulseElements.forEach((pulse) => {
      pulse.style.display = "none";
    });
  }

  // Set up interactions for each icon
  icons.forEach((icon, index) => {
    const categoryIndex = parseInt(icon.dataset.category);

    // Desktop: hover to preview
    addDesktopHover(
      icon,
      () => {
        if (img && imageUrls[categoryIndex]) {
          img.src = imageUrls[categoryIndex].src;
          img.style.opacity = "1";
        }
      },
      () => {
        if (img) {
          img.style.opacity = "0";
        }
      }
    );

    // Mobile: tap to toggle
    addMobileInteraction(
      icon,
      () => {
        if (activeCategoryIndex === categoryIndex) {
          hideImage();
        } else {
          updateImage(categoryIndex);
        }
        stopPulseAnimations();
      },
      { mobileOnly: true }
    );
  });

  // Tap outside to dismiss (mobile only)
  addTapOutsideDismiss(Array.from(icons), hideImage);

  // Auto-hide pulse hints
  setTimeout(stopPulseAnimations, 3000);
</script>
