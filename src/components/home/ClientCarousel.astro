---
import { Image } from "astro:assets";

const imageModules = import.meta.glob("../../assets/clientele/*.png", {
  eager: true,
});
const images = Object.entries(imageModules).map(
  ([path, module]: [string, any]) => {
    const name = path.split("/").pop()?.replace(".png", "") || "";
    return {
      src: module.default,
      alt: `Client logo ${name}`,
      name,
    };
  }
);
---

<section class="w-full overflow-hidden bg-transparent py-7">
  <div class="carousel-container">
    <div class="carousel-track">
      <!-- First set of images -->
      {
        images.map((image, index) => (
          <div class="carousel-item" data-image={image.name} data-index={index}>
            <Image
              src={image.src}
              alt={image.alt}
              class="carousel-image"
              loading="lazy"
            />
          </div>
        ))
      }
      <!-- Duplicate set for seamless infinite scroll -->
      {
        images.map((image, index) => (
          <div
            class="carousel-item"
            data-image={`${image.name}-duplicate`}
            data-index={index + images.length}
          >
            <Image
              src={image.src}
              alt={image.alt}
              class="carousel-image"
              loading="lazy"
            />
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .carousel-container {
    position: relative;
    width: 100%;
  }

  .carousel-track {
    display: flex;
    align-items: center;
    width: fit-content;
    animation: scroll 124s linear infinite;
  }

  .carousel-item {
    flex-shrink: 0;
    width: 300px;
    height: 300px;
    margin-right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(calc(-100% / 2));
    }
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .carousel-item {
      width: 200px;
      height: 200px;
      margin-right: 0;
    }
  }

  @media (max-width: 480px) {
    .carousel-item {
      width: 100px;
      height: 100px;
      margin-right: 0;
    }
  }
</style>
