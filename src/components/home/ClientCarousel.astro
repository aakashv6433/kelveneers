---
import { Image } from "astro:assets";

const imageModules = import.meta.glob("../../assets/clientele/cropped/*.png", {
  eager: true,
});
const images = Object.entries(imageModules).map(
  ([path, module]: [string, any]) => {
    const name = path.split("/").pop()?.replace(".png", "") || "";
    return {
      src: module.default,
      alt: `Client logo ${name}`,
      name,
    };
  }
);

// Sort images numerically by name
images.sort((a, b) => parseInt(a.name) - parseInt(b.name));
---

<section
  class="w-full overflow-hidden bg-transparent py-7"
  id="carousel-section"
>
  <div class="carousel-container">
    <div class="carousel-track">
      <!-- First set of images -->
      {
        images.map((image, index) => (
          <div class="carousel-item" data-image={image.name} data-index={index}>
            <Image
              src={image.src}
              alt={image.alt}
              class="carousel-image"
              loading="eager"
            />
          </div>
        ))
      }
      <!-- Duplicate set for seamless infinite scroll -->
      {
        images.map((image, index) => (
          <div
            class="carousel-item"
            data-image={`${image.name}-duplicate`}
            data-index={index + images.length}
          >
            <Image
              src={image.src}
              alt={image.alt}
              class="carousel-image"
              loading="eager"
            />
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  #carousel-section {
    padding-bottom: 64px;
  }

  .carousel-container {
    position: relative;
    width: 100%;
  }

  .carousel-track {
    display: flex;
    align-items: center;
    width: fit-content;
    animation: scroll 124s linear infinite;
  }

  .carousel-item {
    flex-shrink: 0;
    width: 170px;
    height: 170px;
    margin-right: 110px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  /* Reduce size for specific logos */
  .carousel-item[data-image="46"] .carousel-image,
  .carousel-item[data-image="47"] .carousel-image,
  .carousel-item[data-image="50"] .carousel-image,
  .carousel-item[data-image="51"] .carousel-image,
  .carousel-item[data-image="54"] .carousel-image,
  .carousel-item[data-image="58"] .carousel-image,
  .carousel-item[data-image="61"] .carousel-image,
  .carousel-item[data-image="64"] .carousel-image,
  .carousel-item[data-image="66"] .carousel-image {
    width: 60%;
    height: 60%;
  }

  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(calc(-100% / 2));
    }
  }

  /* Responsive adjustments */
  @media (max-width: 1280px) {
    #carousel-section {
      padding-bottom: 56px;
    }

    .carousel-item {
      width: 140px;
      height: 140px;
      margin-right: 80px;
    }
  }

  @media (max-width: 768px) {
    #carousel-section {
      padding-bottom: 48px;
    }

    .carousel-item {
      width: 100px;
      height: 100px;
      margin-right: 64px;
    }
  }

  @media (max-width: 480px) {
    #carousel-section {
      padding-bottom: 32px;
    }

    .carousel-item {
      width: 70px;
      height: 70px;
      margin-right: 40px;
    }
  }
</style>
